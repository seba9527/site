(window.webpackJsonp=window.webpackJsonp||[]).push([[130],{901:function(t,s,a){"use strict";a.r(s);var n=a(6),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"github-actions简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#github-actions简介"}},[t._v("#")]),t._v(" github actions简介")]),t._v(" "),a("p",[t._v("GitHub Actions 是一个 CI/CD（持续集成/持续部署）工具，但也可用作代码运行环境。功能非常强大，能够玩出许多花样。")]),t._v(" "),a("p",[t._v("GitHub默认会提供一个以下配置的服务器做为 runner。")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("-core CPU\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" GB of RAM memory\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" GB of SSD disk space\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("h2",{attrs:{id:"基本概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本概念"}},[t._v("#")]),t._v(" 基本概念")]),t._v(" "),a("p",[t._v("GitHub Actions 有一些自己的术语。")]),t._v(" "),a("p",[t._v("（1）workflow （工作流程）：持续集成一次运行的过程，就是一个 workflow。")]),t._v(" "),a("p",[t._v("（2）job （任务）：一个 workflow 由一个或多个 jobs 构成，含义是一次持续集成的运行，可以完成多个任务。")]),t._v(" "),a("p",[t._v("（3）step（步骤）：每个 job 由多个 step 构成，一步步完成。")]),t._v(" "),a("p",[t._v("（4）action （动作）：每个 step 可以依次执行一个或多个命令（action）。")]),t._v(" "),a("h2",{attrs:{id:"workflow"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#workflow"}},[t._v("#")]),t._v(" workflow")]),t._v(" "),a("p",[t._v("GitHub Actions 的配置文件叫做 workflow 文件，存放在代码仓库的.github/workflows目录。")]),t._v(" "),a("p",[t._v("workflow 文件采用 YAML 格式，文件名可以任意取，但是后缀名统一为.yml，比如foo.yml。一个库可以有多个 workflow 文件。GitHub 只要发现.github/workflows目录里面有.yml文件，就会自动运行该文件。")]),t._v(" "),a("p",[t._v("workflow 文件的配置字段非常多，详见官方文档。下面是一些基本字段。")]),t._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Greeting from Mona\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" push\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("my-job")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" My Job\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Print a greeting\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MY_VAR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Hi there"),a("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!")]),t._v(" My name is\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("FIRST_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Mona\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MIDDLE_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" The\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("LAST_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Octocat\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n        echo $MY_VAR $FIRST_NAME $MIDDLE_NAME $LAST_NAME.")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br")])]),a("p",[t._v("比如说这样一个 "),a("code",[t._v("yaml")]),t._v(" 文件，说明了当前的工作流名，触发条件。在工作中，指明 "),a("code",[t._v("job_id")]),t._v(" 和任务的说明 "),a("code",[t._v("name")]),t._v(" ，运行所需要的虚拟机环境。步骤则说明了步骤名称、所需的环境变量和步骤运行的命令。")]),t._v(" "),a("h2",{attrs:{id:"敏感数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#敏感数据"}},[t._v("#")]),t._v(" 敏感数据")]),t._v(" "),a("p",[t._v("我们可以在 github repo 上依次点击 Settings -> Secrets 设置 secret")]),t._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" setup aliyun oss\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" manyuanrong/setup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ossutil@master\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" oss"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("beijing.aliyuncs.com\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("access-key-id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.OSS_KEY_ID "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("access-key-secret")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.OSS_KEY_SECRET "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[t._v("这里的 secret 就是一种 context，描述 CI/CD 一个 workflow 中的上下文信息，使用 $"+t._s(t.expression)+" 语法表示。除了 secret，还有")]),t._v(" "),a("ul",[a("li",[t._v("github: workflow 的信息，如 github.sha 可以获取当前的 commit SHA，我们可以利用它为 sentry 或者 docker image 打入版本号")]),t._v(" "),a("li",[t._v("env: 环境变量")]),t._v(" "),a("li",[t._v("job: 当前执行 job 的信息，如 job.status 表示当前 job 的执行状态")]),t._v(" "),a("li",[t._v("matrix: 描述一些构建信息，如 node 以及 os 版本号")])]),t._v(" "),a("p",[t._v("更多 context 信息可以参考官方文档。")]),t._v(" "),a("h2",{attrs:{id:"参考文献"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文献"}},[t._v("#")]),t._v(" 参考文献")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/iBug/iBug-source/blob/master/script/deploy-actions.sh",target:"_blank",rel:"noopener noreferrer"}},[t._v("iBug 的github action脚本"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://ibugone.com/blog/2018/04/build-github-pages-with-travis-ci/",target:"_blank",rel:"noopener noreferrer"}},[t._v("iBug"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub Actions 入门教程"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2019/12/github_actions.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub Actions 教程：定时发送天气邮件"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://shanyue.tech/no-vps/github-action-guide.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("github actions 入门指南及实践"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://didiheng.com/front/2019-12-11.html#github-action%E5%8F%91%E5%B8%83%E9%98%BF%E9%87%8C%E4%BA%91ecs",target:"_blank",rel:"noopener noreferrer"}},[t._v("真香！GitHub Action一键部署"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);