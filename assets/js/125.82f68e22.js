(window.webpackJsonp=window.webpackJsonp||[]).push([[125],{558:function(t,e,s){"use strict";s.r(e);var a=s(14),r=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"什么是cl-cd"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是cl-cd"}},[t._v("#")]),t._v(" 什么是CL/CD")]),t._v(" "),s("h2",{attrs:{id:"travis"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#travis"}},[t._v("#")]),t._v(" Travis")]),t._v(" "),s("h2",{attrs:{id:"github-actions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#github-actions"}},[t._v("#")]),t._v(" GitHub Actions")]),t._v(" "),s("p",[t._v("这部分我写过了，具体可以看那篇文章。")]),t._v(" "),s("h2",{attrs:{id:"webhooks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#webhooks"}},[t._v("#")]),t._v(" WebHooks")]),t._v(" "),s("p",[t._v("什么是Webhook?用中文来说就是 钩子 , 在你的仓库有更改时，有事件发生时，及时的检测到。通过配置webhook，你可以在仓库发生变化时候，立即部署你的线上服务器。还可以将博客部署到服务器，因为我的博客是hexo的，每次换电脑写博客是件特别麻烦的事。")]),t._v(" "),s("p",[t._v("Webhooks允许我们建立关于项目的在GitHub上的事件集成.当事件触发的时候,会通过HTTP POST的方式,向我们的服务器发送请求.我们可以用这个服务器去更新外部跟踪,触发CI build,更新备份镜像,部署到生产服务器.")]),t._v(" "),s("p",[t._v("每个Webhook都可以安装在一个项目或者组织上,安装完毕之后,就可以随着订阅的时间进行触发.")]),t._v(" "),s("p",[t._v("每个项目的每个事件最多可以安装20个Webhook.")]),t._v(" "),s("h3",{attrs:{id:"实质"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实质"}},[t._v("#")]),t._v(" 实质")]),t._v(" "),s("ol",[s("li",[t._v("receive the request")]),t._v(" "),s("li",[t._v("parse the headers, payload and query variables")]),t._v(" "),s("li",[t._v("check if the specified rules for the hook are satisfied")]),t._v(" "),s("li",[t._v("pass the specified arguments to the specified command via command line arguments or via environment variables.")])]),t._v(" "),s("p",[t._v("触发后的HTTP请求会发送特殊的header给我们设定的URL.")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[t._v("Header")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("X-GitHub-Event")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("被触发的事件的名称")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("X-Hub-Signature")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("HMAC十六进制的签名")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("X-GitHub-Delivery")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("这次返回的唯一的ID")])])])]),t._v(" "),s("p",[t._v("具体可以看GitHub上的手册，有详细说明，hmac是用来验证身份的，需要在repo的webhooks上设置一个secret。")]),t._v(" "),s("p",[t._v("这里安利一个GitHub上写的挺好的webhook响应服务器。 https://github.com/adnanh/webhook ，其也提供了docker镜像 https://hub.docker.com/r/almir/webhook 。具体可以看仓库的文档，有说明，配置完成后可以响应GitHub上的request。但是用的alipne，没有git，就很艹，这不是很烦吗。要装git的话还要重新编译一个镜像。")]),t._v(" "),s("p",[t._v("发现可以用wget，那就用wget吧。")]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("docker run -d "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("webhook "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    -v /home/ubuntu/docker/webhook:/etc/webhook "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --restart"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("always "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    almir/webhook -verbose -hooks"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/etc/webhook/hooks.json -hotreload\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("p",[t._v("注意这里是bash脚本要有执行权限，不然会提示找不到，我这里找了半天问题。")]),t._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redeploy-webhook"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"execute-command"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/scripts/redeploy.sh"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"command-working-directory"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/webhook"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("h2",{attrs:{id:"参考文献"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考文献"}},[t._v("#")]),t._v(" 参考文献")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.mindtheproduct.com/what-the-hell-are-ci-cd-and-devops-a-cheatsheet-for-the-rest-of-us/",target:"_blank",rel:"noopener noreferrer"}},[t._v("The Product Managers’ Guide to Continuous Delivery and DevOps"),s("OutboundLink")],1)])])}),[],!1,null,null,null);e.default=r.exports}}]);