<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IDApython实现dump微信GIF表情包 | 吾行吾道，虽远必至</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/icons/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
    <meta name="description" content="分享zjgcjy的个人笔记、读书论文、学习知识">
    <meta name="author" content="zjgcjy">
    <meta name="keywords" content="blog, document, zjgcjy">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/android-chrome-192x192.png">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/assets/css/0.styles.8cd36500.css" as="style"><link rel="preload" href="/assets/js/app.0d0fb6f2.js" as="script"><link rel="preload" href="/assets/js/10.82c11494.js" as="script"><link rel="preload" href="/assets/js/3.321f60fd.js" as="script"><link rel="preload" href="/assets/js/122.27124650.js" as="script"><link rel="preload" href="/assets/js/6.cf3d0550.js" as="script"><link rel="prefetch" href="/assets/js/100.365ad264.js"><link rel="prefetch" href="/assets/js/101.abe25d0e.js"><link rel="prefetch" href="/assets/js/102.c7f14836.js"><link rel="prefetch" href="/assets/js/103.21f2cbc6.js"><link rel="prefetch" href="/assets/js/104.58233a93.js"><link rel="prefetch" href="/assets/js/105.88399408.js"><link rel="prefetch" href="/assets/js/106.b4b9932c.js"><link rel="prefetch" href="/assets/js/107.ad0d35fb.js"><link rel="prefetch" href="/assets/js/108.0929f4ad.js"><link rel="prefetch" href="/assets/js/109.b940bfa8.js"><link rel="prefetch" href="/assets/js/11.8ad2cc0c.js"><link rel="prefetch" href="/assets/js/110.3b1e3494.js"><link rel="prefetch" href="/assets/js/111.b4c7a86e.js"><link rel="prefetch" href="/assets/js/112.cc6bd8d5.js"><link rel="prefetch" href="/assets/js/113.7e61c960.js"><link rel="prefetch" href="/assets/js/114.871955b5.js"><link rel="prefetch" href="/assets/js/115.6de1641b.js"><link rel="prefetch" href="/assets/js/116.4109a8a9.js"><link rel="prefetch" href="/assets/js/117.33668076.js"><link rel="prefetch" href="/assets/js/118.46b2e143.js"><link rel="prefetch" href="/assets/js/119.fc3cfeca.js"><link rel="prefetch" href="/assets/js/12.f80b5144.js"><link rel="prefetch" href="/assets/js/120.ab2d4cca.js"><link rel="prefetch" href="/assets/js/121.3d33662c.js"><link rel="prefetch" href="/assets/js/123.665722ba.js"><link rel="prefetch" href="/assets/js/124.57fb4cad.js"><link rel="prefetch" href="/assets/js/125.05547a9f.js"><link rel="prefetch" href="/assets/js/126.0d2ff294.js"><link rel="prefetch" href="/assets/js/127.7092b99e.js"><link rel="prefetch" href="/assets/js/128.fa65a0a7.js"><link rel="prefetch" href="/assets/js/129.bb6db82c.js"><link rel="prefetch" href="/assets/js/13.e7e91204.js"><link rel="prefetch" href="/assets/js/130.9fbb0c69.js"><link rel="prefetch" href="/assets/js/131.b2048d61.js"><link rel="prefetch" href="/assets/js/132.06817910.js"><link rel="prefetch" href="/assets/js/133.d84d990e.js"><link rel="prefetch" href="/assets/js/134.40b14642.js"><link rel="prefetch" href="/assets/js/135.595fefd2.js"><link rel="prefetch" href="/assets/js/136.35573eaa.js"><link rel="prefetch" href="/assets/js/137.62f890c1.js"><link rel="prefetch" href="/assets/js/138.c5803539.js"><link rel="prefetch" href="/assets/js/139.a08102f0.js"><link rel="prefetch" href="/assets/js/14.08d63ee6.js"><link rel="prefetch" href="/assets/js/140.48a6436d.js"><link rel="prefetch" href="/assets/js/141.9e983e77.js"><link rel="prefetch" href="/assets/js/142.43d39fb4.js"><link rel="prefetch" href="/assets/js/143.6eb7fda3.js"><link rel="prefetch" href="/assets/js/144.29f80905.js"><link rel="prefetch" href="/assets/js/145.8b3fb9c7.js"><link rel="prefetch" href="/assets/js/146.010eda21.js"><link rel="prefetch" href="/assets/js/147.7dc9fd67.js"><link rel="prefetch" href="/assets/js/148.bd90772a.js"><link rel="prefetch" href="/assets/js/149.22319a7a.js"><link rel="prefetch" href="/assets/js/15.36064fc8.js"><link rel="prefetch" href="/assets/js/150.997e6df5.js"><link rel="prefetch" href="/assets/js/151.24183157.js"><link rel="prefetch" href="/assets/js/152.eb73c0fb.js"><link rel="prefetch" href="/assets/js/153.e13bfe23.js"><link rel="prefetch" href="/assets/js/154.9db4617e.js"><link rel="prefetch" href="/assets/js/155.827832ff.js"><link rel="prefetch" href="/assets/js/156.66c48606.js"><link rel="prefetch" href="/assets/js/157.38bebb54.js"><link rel="prefetch" href="/assets/js/158.93d80b40.js"><link rel="prefetch" href="/assets/js/159.3e6b8936.js"><link rel="prefetch" href="/assets/js/16.4d5a2350.js"><link rel="prefetch" href="/assets/js/160.27f81049.js"><link rel="prefetch" href="/assets/js/161.0695be1e.js"><link rel="prefetch" href="/assets/js/162.3d02a78e.js"><link rel="prefetch" href="/assets/js/163.997c4bb7.js"><link rel="prefetch" href="/assets/js/164.e524506a.js"><link rel="prefetch" href="/assets/js/165.2e38fa83.js"><link rel="prefetch" href="/assets/js/166.d6c7aacf.js"><link rel="prefetch" href="/assets/js/167.5f8dd325.js"><link rel="prefetch" href="/assets/js/168.197b0ddd.js"><link rel="prefetch" href="/assets/js/169.2773d92f.js"><link rel="prefetch" href="/assets/js/17.cab7fe60.js"><link rel="prefetch" href="/assets/js/170.38f85cd4.js"><link rel="prefetch" href="/assets/js/171.4b3a3587.js"><link rel="prefetch" href="/assets/js/172.efa98cb9.js"><link rel="prefetch" href="/assets/js/173.a439f204.js"><link rel="prefetch" href="/assets/js/174.701ac0bd.js"><link rel="prefetch" href="/assets/js/175.874a16b6.js"><link rel="prefetch" href="/assets/js/176.64effa0d.js"><link rel="prefetch" href="/assets/js/177.b9007548.js"><link rel="prefetch" href="/assets/js/178.1ab7223c.js"><link rel="prefetch" href="/assets/js/179.82b4bf0c.js"><link rel="prefetch" href="/assets/js/18.ee407f46.js"><link rel="prefetch" href="/assets/js/180.333e4e97.js"><link rel="prefetch" href="/assets/js/181.4644b42c.js"><link rel="prefetch" href="/assets/js/182.bf113d4f.js"><link rel="prefetch" href="/assets/js/183.8bb121a9.js"><link rel="prefetch" href="/assets/js/184.c854b7a2.js"><link rel="prefetch" href="/assets/js/185.64504728.js"><link rel="prefetch" href="/assets/js/186.af3b6dcf.js"><link rel="prefetch" href="/assets/js/187.cafb1e01.js"><link rel="prefetch" href="/assets/js/188.5e0f2b0e.js"><link rel="prefetch" href="/assets/js/189.f214666c.js"><link rel="prefetch" href="/assets/js/19.befaf473.js"><link rel="prefetch" href="/assets/js/20.578d16bb.js"><link rel="prefetch" href="/assets/js/21.0ccb9fb4.js"><link rel="prefetch" href="/assets/js/22.5bbb0087.js"><link rel="prefetch" href="/assets/js/23.c9dec188.js"><link rel="prefetch" href="/assets/js/24.8ea28b98.js"><link rel="prefetch" href="/assets/js/25.b723b744.js"><link rel="prefetch" href="/assets/js/26.2ddaca80.js"><link rel="prefetch" href="/assets/js/27.2941f641.js"><link rel="prefetch" href="/assets/js/28.2d6d5def.js"><link rel="prefetch" href="/assets/js/29.fb1c75ad.js"><link rel="prefetch" href="/assets/js/30.68c9be8b.js"><link rel="prefetch" href="/assets/js/31.3794c4a3.js"><link rel="prefetch" href="/assets/js/32.bea816b5.js"><link rel="prefetch" href="/assets/js/33.fe5e013e.js"><link rel="prefetch" href="/assets/js/34.f64712f9.js"><link rel="prefetch" href="/assets/js/35.2bea5136.js"><link rel="prefetch" href="/assets/js/36.c27f48fd.js"><link rel="prefetch" href="/assets/js/37.e112280c.js"><link rel="prefetch" href="/assets/js/38.8de63378.js"><link rel="prefetch" href="/assets/js/39.96779350.js"><link rel="prefetch" href="/assets/js/4.9bc59980.js"><link rel="prefetch" href="/assets/js/40.6ab44ac9.js"><link rel="prefetch" href="/assets/js/41.08e557c5.js"><link rel="prefetch" href="/assets/js/42.7ff3fe71.js"><link rel="prefetch" href="/assets/js/43.158bba5c.js"><link rel="prefetch" href="/assets/js/44.35d70c3d.js"><link rel="prefetch" href="/assets/js/45.9900382e.js"><link rel="prefetch" href="/assets/js/46.1b2c7d96.js"><link rel="prefetch" href="/assets/js/47.336a95bb.js"><link rel="prefetch" href="/assets/js/48.7ca852ad.js"><link rel="prefetch" href="/assets/js/49.ed8ff81c.js"><link rel="prefetch" href="/assets/js/5.b9229a6c.js"><link rel="prefetch" href="/assets/js/50.77fb4cbd.js"><link rel="prefetch" href="/assets/js/51.dbdd5144.js"><link rel="prefetch" href="/assets/js/52.57b2f179.js"><link rel="prefetch" href="/assets/js/53.2762b871.js"><link rel="prefetch" href="/assets/js/54.9f51f95e.js"><link rel="prefetch" href="/assets/js/55.d0df8799.js"><link rel="prefetch" href="/assets/js/56.ba1847d2.js"><link rel="prefetch" href="/assets/js/57.ecd0c2bd.js"><link rel="prefetch" href="/assets/js/58.de0fda25.js"><link rel="prefetch" href="/assets/js/59.d1ed7749.js"><link rel="prefetch" href="/assets/js/60.66a53304.js"><link rel="prefetch" href="/assets/js/61.a3aaf036.js"><link rel="prefetch" href="/assets/js/62.75bc2686.js"><link rel="prefetch" href="/assets/js/63.7f0e6b0f.js"><link rel="prefetch" href="/assets/js/64.8ed62110.js"><link rel="prefetch" href="/assets/js/65.d7880a08.js"><link rel="prefetch" href="/assets/js/66.ba24f811.js"><link rel="prefetch" href="/assets/js/67.b667fa05.js"><link rel="prefetch" href="/assets/js/68.ecf0e3df.js"><link rel="prefetch" href="/assets/js/69.94dfc273.js"><link rel="prefetch" href="/assets/js/7.667c6757.js"><link rel="prefetch" href="/assets/js/70.a680ea5d.js"><link rel="prefetch" href="/assets/js/71.1e4e4e84.js"><link rel="prefetch" href="/assets/js/72.98070809.js"><link rel="prefetch" href="/assets/js/73.191bf09c.js"><link rel="prefetch" href="/assets/js/74.3703a1cc.js"><link rel="prefetch" href="/assets/js/75.3e89cf6a.js"><link rel="prefetch" href="/assets/js/76.66d93782.js"><link rel="prefetch" href="/assets/js/77.4b64585b.js"><link rel="prefetch" href="/assets/js/78.f6da29d6.js"><link rel="prefetch" href="/assets/js/79.e18b7959.js"><link rel="prefetch" href="/assets/js/8.1f25eb6e.js"><link rel="prefetch" href="/assets/js/80.5b5131a2.js"><link rel="prefetch" href="/assets/js/81.d5ea70cb.js"><link rel="prefetch" href="/assets/js/82.85185f57.js"><link rel="prefetch" href="/assets/js/83.7283a52e.js"><link rel="prefetch" href="/assets/js/84.f72ab82d.js"><link rel="prefetch" href="/assets/js/85.1b091be8.js"><link rel="prefetch" href="/assets/js/86.699fd603.js"><link rel="prefetch" href="/assets/js/87.c18f6645.js"><link rel="prefetch" href="/assets/js/88.67adf348.js"><link rel="prefetch" href="/assets/js/89.7acc9387.js"><link rel="prefetch" href="/assets/js/9.f07aceae.js"><link rel="prefetch" href="/assets/js/90.bd32e938.js"><link rel="prefetch" href="/assets/js/91.da8be0ce.js"><link rel="prefetch" href="/assets/js/92.3c83de0c.js"><link rel="prefetch" href="/assets/js/93.0ebebd12.js"><link rel="prefetch" href="/assets/js/94.7ec10d45.js"><link rel="prefetch" href="/assets/js/95.a3510831.js"><link rel="prefetch" href="/assets/js/96.199c7f96.js"><link rel="prefetch" href="/assets/js/97.c41f2eb9.js"><link rel="prefetch" href="/assets/js/98.bdef68bb.js"><link rel="prefetch" href="/assets/js/99.88d75108.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.b6a0ed3d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8cd36500.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/nav-logo.png" alt="吾行吾道，虽远必至" class="logo"> <span class="site-name can-hide">吾行吾道，虽远必至</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档" class="dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          论文
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/papers/academic_papers/" class="nav-link">
  学术论文
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/papers/other_papers/" class="nav-link">
  其他文章
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CTF" class="dropdown-title"><span class="title">CTF</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          CTF笔记
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ctf/reverse/" class="nav-link">
  Reverse
</a></li><li class="dropdown-subitem"><a href="/ctf/pwn/" class="nav-link">
  Pwn
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/ctf/writeup/" class="nav-link">
  writeup
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言" class="dropdown-title"><span class="title">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/languages/cplusplus/" class="nav-link">
  C++
</a></li><li class="dropdown-item"><!----> <a href="/languages/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/languages/android/" class="nav-link">
  Android
</a></li><li class="dropdown-item"><!----> <a href="/languages/golang/" class="nav-link">
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/languages/rust/" class="nav-link">
  Rust
</a></li><li class="dropdown-item"><!----> <a href="/languages/vc/" class="nav-link">
  VC
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具与项目" class="dropdown-title"><span class="title">工具与项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/" class="nav-link">
  工具
</a></li><li class="dropdown-item"><!----> <a href="/projects/" class="nav-link router-link-active">
  项目
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="杂谈" class="dropdown-title"><span class="title">杂谈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/diary/" class="nav-link">
  日记
</a></li><li class="dropdown-item"><!----> <a href="/others/" class="nav-link">
  其他
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多vuepress" class="dropdown-title"><span class="title">vuepress</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          指南
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/guide/" class="nav-link">
  指南
</a></li><li class="dropdown-subitem"><a href="/vue/config/" class="nav-link">
  配置
</a></li></ul></li><li class="dropdown-item"><h4>
          主题与插件
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/plugin/" class="nav-link">
  插件
</a></li><li class="dropdown-subitem"><a href="/vue/theme/" class="nav-link">
  主题
</a></li></ul></li><li class="dropdown-item"><h4>
          API
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/api/cli.html" class="nav-link">
  CLI
</a></li><li class="dropdown-subitem"><a href="/vue/api/node.html" class="nav-link">
  Node
</a></li></ul></li><li class="dropdown-item"><h4>
          开发指南
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/miscellaneous/local-development.html" class="nav-link">
  本地开发
</a></li><li class="dropdown-subitem"><a href="/vue/miscellaneous/design-concepts.html" class="nav-link">
  设计理念
</a></li><li class="dropdown-subitem"><a href="/vue/faq/" class="nav-link">
  FAQ
</a></li><li class="dropdown-subitem"><a href="/vue/miscellaneous/glossary.html" class="nav-link">
  术语
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about.html" class="nav-link">
  关于我
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/zjgcjy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档" class="dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          论文
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/papers/academic_papers/" class="nav-link">
  学术论文
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/papers/other_papers/" class="nav-link">
  其他文章
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CTF" class="dropdown-title"><span class="title">CTF</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          CTF笔记
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ctf/reverse/" class="nav-link">
  Reverse
</a></li><li class="dropdown-subitem"><a href="/ctf/pwn/" class="nav-link">
  Pwn
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/ctf/writeup/" class="nav-link">
  writeup
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言" class="dropdown-title"><span class="title">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/languages/cplusplus/" class="nav-link">
  C++
</a></li><li class="dropdown-item"><!----> <a href="/languages/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/languages/android/" class="nav-link">
  Android
</a></li><li class="dropdown-item"><!----> <a href="/languages/golang/" class="nav-link">
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/languages/rust/" class="nav-link">
  Rust
</a></li><li class="dropdown-item"><!----> <a href="/languages/vc/" class="nav-link">
  VC
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具与项目" class="dropdown-title"><span class="title">工具与项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/" class="nav-link">
  工具
</a></li><li class="dropdown-item"><!----> <a href="/projects/" class="nav-link router-link-active">
  项目
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="杂谈" class="dropdown-title"><span class="title">杂谈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/diary/" class="nav-link">
  日记
</a></li><li class="dropdown-item"><!----> <a href="/others/" class="nav-link">
  其他
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多vuepress" class="dropdown-title"><span class="title">vuepress</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          指南
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/guide/" class="nav-link">
  指南
</a></li><li class="dropdown-subitem"><a href="/vue/config/" class="nav-link">
  配置
</a></li></ul></li><li class="dropdown-item"><h4>
          主题与插件
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/plugin/" class="nav-link">
  插件
</a></li><li class="dropdown-subitem"><a href="/vue/theme/" class="nav-link">
  主题
</a></li></ul></li><li class="dropdown-item"><h4>
          API
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/api/cli.html" class="nav-link">
  CLI
</a></li><li class="dropdown-subitem"><a href="/vue/api/node.html" class="nav-link">
  Node
</a></li></ul></li><li class="dropdown-item"><h4>
          开发指南
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/miscellaneous/local-development.html" class="nav-link">
  本地开发
</a></li><li class="dropdown-subitem"><a href="/vue/miscellaneous/design-concepts.html" class="nav-link">
  设计理念
</a></li><li class="dropdown-subitem"><a href="/vue/faq/" class="nav-link">
  FAQ
</a></li><li class="dropdown-subitem"><a href="/vue/miscellaneous/glossary.html" class="nav-link">
  术语
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about.html" class="nav-link">
  关于我
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/zjgcjy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>项目笔记</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/projects/" aria-current="page" class="sidebar-link">项目笔记</a></li><li><a href="/projects/idapython-cracking-wechat.html" aria-current="page" class="active sidebar-link">IDApython实现dump微信GIF表情包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/projects/idapython-cracking-wechat.html#老版微信如何保存gif" class="sidebar-link">老版微信如何保存GIF</a></li><li class="sidebar-sub-header"><a href="/projects/idapython-cracking-wechat.html#新版微信对gif缓存做了什么处理" class="sidebar-link">新版微信对GIF缓存做了什么处理</a></li><li class="sidebar-sub-header"><a href="/projects/idapython-cracking-wechat.html#如何分析加密数据" class="sidebar-link">如何分析加密数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/projects/idapython-cracking-wechat.html#如何看待这7个字节" class="sidebar-link">如何看待这7个字节</a></li></ul></li><li class="sidebar-sub-header"><a href="/projects/idapython-cracking-wechat.html#开始分析wechatwin-dll" class="sidebar-link">开始分析WeChatWin.dll</a></li><li class="sidebar-sub-header"><a href="/projects/idapython-cracking-wechat.html#第二段加密-异或" class="sidebar-link">第二段加密-异或</a></li><li class="sidebar-sub-header"><a href="/projects/idapython-cracking-wechat.html#第一段加密-rsa" class="sidebar-link">第一段加密-rsa</a></li><li class="sidebar-sub-header"><a href="/projects/idapython-cracking-wechat.html#如何获取gif" class="sidebar-link">如何获取GIF</a></li><li class="sidebar-sub-header"><a href="/projects/idapython-cracking-wechat.html#idapython的debugger-hooks" class="sidebar-link">idapython的Debugger Hooks</a></li><li class="sidebar-sub-header"><a href="/projects/idapython-cracking-wechat.html#完整代码及说明" class="sidebar-link">完整代码及说明</a></li><li class="sidebar-sub-header"><a href="/projects/idapython-cracking-wechat.html#写在最后" class="sidebar-link">写在最后</a></li><li class="sidebar-sub-header"><a href="/projects/idapython-cracking-wechat.html#战果" class="sidebar-link">战果</a></li></ul></li><li><a href="/projects/analysis-ms-17-010.html" class="sidebar-link">MS17-010永恒之蓝分析</a></li><li><a href="/projects/manual-of-xen.html" class="sidebar-link">Xen配置手册</a></li><li><a href="/projects/manual-debug-windows-on-xen.html" class="sidebar-link">基于Xen的Windows双机内核调试</a></li><li><a href="/projects/anti-antivirus-technology.html" class="sidebar-link">黑客免杀攻防读书笔记-1</a></li><li><a href="/projects/bypass-antivirus-technolgy.html" class="sidebar-link">免杀最新技术研究</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>最近一周都没课了。emm，闲来无事想从微信上下一波表情包。然而微信在我不知不觉中更新了。以前的套路没法用了，于是自己就花时间研究了一下。特记此文。
使用的工具主要是IDA，分析的对象是PC新版微信客户端，目标是获取GIF动图。
ps:我这指的GIF是指微信表情商店里的表情（只能发送给别人，没办法保存到本地）</p></blockquote> <h2 id="老版微信如何保存gif"><a href="#老版微信如何保存gif" class="header-anchor">#</a> 老版微信如何保存GIF</h2> <p>做这件事情的起因就是发现我PC上的微信自己更新了，那么就先安利一下老版本如何截取GIF图片。我使用的是PC版的微信客户端，有关Android版的不在讨论范围内。</p> <p>首先我们找到PC版的用户配置文件夹。一般在文档文件夹下，以微信id表示账号。如下图所示。</p> <p><img src="/img/2018-08/Snipaste_2018-05-06_14-06-40.png" alt="wx"></p> <p>其中的<code>CustomEmotions</code>就是老版本微信缓存的GIF位置，当我们登陆PC版微信，然后用手机给别人发图的时候。消息同会同步到PC上，其中的GIF图片被处理后保存到这个文件夹内。具体是怎样处理的我也忘了，好像就是改GIF文件头部，其他没有变化。这样我们就能得到GIF了。</p> <h2 id="新版微信对gif缓存做了什么处理"><a href="#新版微信对gif缓存做了什么处理" class="header-anchor">#</a> 新版微信对GIF缓存做了什么处理</h2> <p>但是微信更新后，此时<code>CustomEmotions</code>文件夹内不会保存任何东西，甚至删除该文件夹也不会影响微信接受消息。这时所有的GIF被保存到<code>CustomEmoV1</code>文件夹内，而且均被加密处理。为了演示效果，我首先将该文件夹清空，然后用手机给别人发图（手动滑稽），效果如下图所示。</p> <p><img src="/img/2018-08/Snipaste_2018-05-06_14-25-46.png" alt="wx2"></p> <p>此时PC上同步显示图片，同时GIF被保存到<code>CustomEmoV1</code>文件夹内，如下图所示。</p> <p><img src="/img/2018-08/Snipaste_2018-05-06_14-26-31.png" alt="wx3"></p> <p>很明显，一张GIF对于一个文件，文件名32位长，可能是MD5。然后我们选择一个文件打开。</p> <p><img src="/img/2018-08/Snipaste_2018-05-06_14-33-06.png" alt="wx4"></p> <p>可以看到文件头被修改成V1MMWX，WX肯定指的就是微信了，V1MM不知道是什么，应该是微信开发人员定义的格式。不仅如此，熟悉GIF格式的童鞋也不难发现，除了文件头，下面的内容也被加密了。</p> <p>下面我就讲一下我是怎么分析这个文件的。</p> <h2 id="如何分析加密数据"><a href="#如何分析加密数据" class="header-anchor">#</a> 如何分析加密数据</h2> <p>首先看一下文件的大小是否发生变化。这里我要解释一下的是，我以前曾经从老版的微信上获取过GIF，这些GIF我都保存了，所以可以直接用该GIF和加密后的GIF进行对比，就不截图了。对比的结果是：加密后的大小比加密前的大小多7字节。</p> <h3 id="如何看待这7个字节"><a href="#如何看待这7个字节" class="header-anchor">#</a> 如何看待这7个字节</h3> <ul><li>我认为其中有6个字节是V1MMWX这个文件头造成的影响。</li> <li>对100KB左右的文件来说，加密是需要时间的，但是微信是即时通讯工具，开发人员应该不会使用复杂的加密算法。</li> <li>整体上来说，加密前后数据量大小是一致的。</li></ul> <p>基于以上三点，我猜测就是一个简单的亦或加密。然后我用python的xortool分析了一下该文件。</p> <p><img src="/img/2018-08/Snipaste_2018-05-06_14-54-44.png" alt="wx5"></p> <p>然后自动分析出极大可能解，这里它给出了一个key是0x2b('+')。</p> <p><img src="/img/2018-08/Snipaste_2018-05-06_14-56-46.png" alt="wx6"></p> <p>最后我将得到的文件和原始文件比对。</p> <p><img src="/img/2018-08/Snipaste_2018-05-06_15-01-54.png" alt="wx7"></p> <p>惊人的发现！除了前0x3ff字节不一样，后面的字节都是一样的，也就是说，加密的方式其中之一就是亦或。具体就是对文件从0x400开始的字节亦或0x2b。</p> <p>到现在为止，我已经知道了文件后面一部分的加密方式，如何解密前面一部分呢？我认为还是要抓住V1MM这个文件头，因为这个头是开发人员固定的，那么这个值应该是个明文，或者说是应该是某个exe或者dll中.rdata段的（我只能期望它不是SMC之类动态生成的了）于是我就去微信安装目录下找这个字符串在哪。
结合exe和dll的名称、以及更新日期，我很幸运的找到了。</p> <p><img src="/img/2018-08/Snipaste_2018-05-06_15-15-51.png" alt="wx8"></p> <p>找到之后很显然要干什么了。开IDA吧。</p> <h2 id="开始分析wechatwin-dll"><a href="#开始分析wechatwin-dll" class="header-anchor">#</a> 开始分析WeChatWin.dll</h2> <p>由于这个dll相当的大，IDA分析了很久才完，我也是第二次分析这么大的东西（第一次是某CTF的tensorflow），话不多说，直接shift+f12找V1MM字符串的位置。然后我就惊了，ida没找到，估计是类型不对吧。无奈，只好手工定位了。第一次失败了，忘了是FOA了，要转成RVA。算了，直接定位到.rdata基址，直接用偏移，终于发现了V1MM的位置。</p> <p><img src="/img/2018-08/Snipaste_2018-05-06_15-25-17.png" alt="wx9"></p> <p>然后就交叉引用，发现有三处，其中2处由同一个函数引用（另外一处应该是CRT或者编译器函数）进入这个函数分析。直接f5后，能发现关键的几行代码，如下图所示。</p> <p><img src="/img/2018-08/Snipaste_2018-05-06_15-31-07.png" alt="wx10"></p> <p>这几行就是GIF加密后保存的地方了，首先将6字节的V1MMMX复制到cipher指针指向的首地址，然后是2个move函数，也可以理解是memcpy。而且第一个是从cipher指针指向首地址向后移动6字节开始的，那肯定就是上文中未解密的部分了。第二个move又是从第一个move结束的地方开始的，那就是上文提到的异或算法了。</p> <p>由于这段是最后部分，加密都处理完了，我们需要往上看，同时整体把握这个函数的作用。</p> <p><img src="/img/2018-08/Snipaste_2018-05-06_15-43-21.png" alt="wx11"></p> <p>可以发现，该函数应该是一个BOOL类型的函数，若处理成功则返回1，否则返回0。还能发现的是，cipher虽然是个局部变量，但在函数第一行可以发现它被指向了该函数的第二个参数，考虑到是BOOL类型的函数，函数只能返回一个值，那么对这个处理的函数而言，只有可能将文件句柄作为参数传入，修改后才能有效。也就是说该函数的第一个参数应该是文件句柄，而指向加密内容的第二个参数应该是加密后的指针所指向的地方。
还有一些地方指的思考，比如a1[1]这个地方的值是什么。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>a1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在函数一开始，就比较a1[1]这个地方的值，小于0则直接返回，我猜测是是文件大小的意思。后面的代码直接验证了我的猜想。</p> <p><img src="/img/2018-08/Snipaste_2018-05-06_15-57-00.png" alt="wx12"></p> <p>看到了熟悉的0x3ff，上文已经提到了，加密的GIF前面0x3ff的加密方式还是未知的，这里直接比较a1[1]和0x3ff的大小，其实就是判断GIF的大小，如果比0x3ff小，那么v7变量就不能想0x3ff，而是文件的大小。也就是说如果GIF本身大小不超过0x3ff，就不会使用第二部分的异或加密。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">a</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span><span class="token operator">*</span> file<span class="token punctuation">;</span>
    <span class="token keyword">int</span> size<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>分析完这部分，我们可以将该函数的第一个参数转换成结构体，第一个值是文件内容指针，第二个值是文件的大小。关于这个值怎么得到并传入该函数的，不是我们分析的重点。</p> <p><img src="/img/2018-08/Snipaste_2018-05-06_16-05-26.png" alt="wx13"></p> <p>回过头来再看最后一部分传入的第二个参数，其实我们就能分别找到那2个加密的函数。其中绿色框中的2个函数就是加密的2个函数。
我们先看第二个函数，也就是异或那个。</p> <h2 id="第二段加密-异或"><a href="#第二段加密-异或" class="header-anchor">#</a> 第二段加密-异或</h2> <p><img src="/img/2018-08/Snipaste_2018-05-06_16-08-53.png" alt="wx14"></p> <p>进入这个函数就能看到，很明显的取了一个byte(0x2b)，然后循环异或，具体的过程我就不分析了，只是验证一下，因为最开始的时候我已经用xortool自动分析出来了。有兴趣的可以分析一下，或者动态调试一下看看是怎么加密的。</p> <h2 id="第一段加密-rsa"><a href="#第一段加密-rsa" class="header-anchor">#</a> 第一段加密-rsa</h2> <p>这个第一段加密很复杂，emm看着就不想分析了，看见一串明文<code>crypto\\rsa\\rsa_lib.c</code>更是让我感到绝望。</p> <p><img src="/img/2018-08/Snipaste_2018-05-06_16-18-16.png" alt="wx15"></p> <p><img src="/img/2018-08/Snipaste_2018-05-06_16-19-01.png" alt="wx16"></p> <p>哇，是真的绝望。。。
然后就没有然后了，我是没有分析下去。应该是解密不了的。毕竟输出的是一个缓存文件，如果要分析微信是否能读取GIF缓存，或者说读取的格式是怎样的，我的功力还不够。。。（我要弃坑，我要转web）
讲道理，上面的路已经不通了，下面开始想想别的方法。</p> <h2 id="如何获取gif"><a href="#如何获取gif" class="header-anchor">#</a> 如何获取GIF</h2> <p>其实方法我刚刚已经提示了，因为这个函数接受的参数就是完整的GIF，这个结构体上面也解释了，只要获取这个结构体就能拿到完整的GIF。因此，我们返回到原来那个函数的入口点，看什么时候结构体参数被引用。</p> <p><img src="/img/2018-08/Snipaste_2018-05-06_16-37-44.png" alt="wx17"></p> <p>显然就是这里了，在将参数传给edi后，后面就判断结构体的第二个属性，即文件长度是否大于0。如果我们能在dll每次运行到这里的时候获取这两个数据，然后dump指定内存，就能拖出这个GIF图，也就不需要解密了。然后我动态调试了很多次，幸运的是并没有触发什么反调试和异常，使用的方式是idapython，首先是手动加载。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>location <span class="token operator">=</span> GetRegValue<span class="token punctuation">(</span><span class="token string">'edi'</span><span class="token punctuation">)</span>
sizeptr <span class="token operator">=</span> GetRegValue<span class="token punctuation">(</span><span class="token string">'edi'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0x4</span>
start <span class="token operator">=</span> Dword<span class="token punctuation">(</span>location<span class="token punctuation">)</span>
n <span class="token operator">=</span> Dword<span class="token punctuation">(</span>sizeptr<span class="token punctuation">)</span>
f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>savepath<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.gif'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">xrange</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>Byte<span class="token punctuation">(</span>start <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>然后每次都发个图给别人，PC就会缓存，然后GIF就会被保存下来了。如果每次都是手动加载的话，我记得这段代码是没问题的。但是不想每次都由我自己来下断点然后dump，为了实现自动化，自己也是学习了一波idapython来自定义Debugger Hook。</p> <h2 id="idapython的debugger-hooks"><a href="#idapython的debugger-hooks" class="header-anchor">#</a> idapython的Debugger Hooks</h2> <p>主要用于Hook IDA 内部的调试器，同时可以自定义调试功能。结构如下</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">DbgHook</span><span class="token punctuation">(</span>DBG_Hooks<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">dbg_process_start</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pid<span class="token punctuation">,</span> tid<span class="token punctuation">,</span> ea<span class="token punctuation">,</span> name<span class="token punctuation">,</span> base<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span>
    <span class="token keyword">def</span> <span class="token function">dbg_process_exit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pid<span class="token punctuation">,</span> tid<span class="token punctuation">,</span> ea<span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span>
    <span class="token keyword">def</span> <span class="token function">dbg_library_load</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pid<span class="token punctuation">,</span> tid<span class="token punctuation">,</span> ea<span class="token punctuation">,</span> name<span class="token punctuation">,</span> base<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span>
    <span class="token keyword">def</span> <span class="token function">dbg_bpt</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> tid<span class="token punctuation">,</span> ea<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>安装hook的方式如下</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>debugger <span class="token operator">=</span> DbgHook<span class="token punctuation">(</span><span class="token punctuation">)</span>
debugger<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>一开始我是在dbg_process_start来自动插入断点的，但是后来发现效果并不会，这一点我之后会说明。</p> <p>我通过定义了MyDbgHook来继承DBG_Hooks，再次载入上面的脚本运行，结果却是这样的。</p> <p><img src="/img/2018-08/Snipaste_2018-05-06_16-53-53.png" alt="wx18"></p> <p>文件里写的都是0xff。除了这种情况还会发生发送多个图片，获取的GIF均是同一个的离奇事件。查了半天不知道哪里出了原因。最后翻idapython的资料，最后发现是api使用不当，但是具体是为什么也没有资料，感觉Dword(ea)和DbgDword(ea)之类的都差不多，可能一个前面有dbg所以是dbg专用的吗。
更新后的脚本。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>location <span class="token operator">=</span> GetRegValue<span class="token punctuation">(</span><span class="token string">'edi'</span><span class="token punctuation">)</span>
sizeptr <span class="token operator">=</span> GetRegValue<span class="token punctuation">(</span><span class="token string">'edi'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0x4</span>
start <span class="token operator">=</span> DbgDword<span class="token punctuation">(</span>location<span class="token punctuation">)</span>
n <span class="token operator">=</span> DbgDword<span class="token punctuation">(</span>sizeptr<span class="token punctuation">)</span>
f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>savepath<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'.gif'</span><span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">xrange</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
	f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>Byte<span class="token punctuation">(</span>start<span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>运行结果如下图。</p> <p><img src="/img/2018-08/Snipaste_2018-05-06_17-04-41.png" alt="wx19"></p> <p>更新后，效果好了很多，但是还是有问题，有的能显示，有的GIF显示不了，于是又查了一波idapython资料，最后发现还是api使用不当。。。Byte(ea)、DbgByte(ea)还有DbgRead(ea,n)，其实功能都是一样的，可能是Dbg的方式影响了某些API的实现，导致出现了很多问题。
再次更新脚本。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>location <span class="token operator">=</span> GetRegValue<span class="token punctuation">(</span><span class="token string">'edi'</span><span class="token punctuation">)</span>
sizeptr <span class="token operator">=</span> GetRegValue<span class="token punctuation">(</span><span class="token string">'edi'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0x4</span>
<span class="token keyword">print</span> <span class="token string">&quot;[*]\tGif location:[%08x],sizeptr:[%08x]&quot;</span><span class="token operator">%</span> <span class="token punctuation">(</span>location<span class="token punctuation">,</span> sizeptr<span class="token punctuation">)</span>
start <span class="token operator">=</span> DbgDword<span class="token punctuation">(</span>location<span class="token punctuation">)</span>
n <span class="token operator">=</span> DbgDword<span class="token punctuation">(</span>sizeptr<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token string">&quot;[*]\tGif start:[%08x],n:[%08x]&quot;</span><span class="token operator">%</span> <span class="token punctuation">(</span>start<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
dump <span class="token operator">=</span> DbgRead<span class="token punctuation">(</span>start<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>savepath<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'.gif'</span><span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>dump<span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
self<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>ida日志输出如下图。</p> <p><img src="/img/2018-08/Snipaste_2018-05-06_17-13-15.png" alt="wx20"></p> <p>运行结果如下图。</p> <p><img src="/img/2018-08/Snipaste_2018-05-06_17-11-09.png" alt="wx21"></p> <h2 id="完整代码及说明"><a href="#完整代码及说明" class="header-anchor">#</a> 完整代码及说明</h2> <p>代码的几点说明：</p> <ul><li>dbg_process_start是最先加载的，在这里下断点会导致问题。</li> <li>Modules()用于遍历整个环境中的模块，一开始我是想通过这个下断点的，后来发现DBG_Hooks已经提供了类似的函数，就是dbg_library_load，由于我的目标是<code>WeChatWin.dll</code>，当其加载的时候下断点就行了。</li> <li>下断点的方式是通过偏移量来实现的，考虑到ASLR或者其他不可抗因素，直接VA下断不可行，通过模块BA+0x1000+offsite来实现，0x1000就是.text的VirtualAddress，详细可以参照PE中的节表。</li> <li>Dbg模式下请使用ida python对应的API，否则如上文所述会导致未知情况。如将Dword(ea)替换成DbgDword(ea)。</li></ul> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding:utf-8</span>
__author__<span class="token operator">=</span><span class="token string">'zjgcjy'</span>

<span class="token keyword">from</span> idaapi <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> idautils <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> idc <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> os

<span class="token comment"># 没用到，效果不好，或者说dbg_library_load更方便</span>
<span class="token keyword">def</span> <span class="token function">Modules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    mod <span class="token operator">=</span> idaapi<span class="token punctuation">.</span>module_info_t<span class="token punctuation">(</span><span class="token punctuation">)</span>
    result <span class="token operator">=</span> idaapi<span class="token punctuation">.</span>get_first_module<span class="token punctuation">(</span>mod<span class="token punctuation">)</span>
    <span class="token keyword">while</span> result<span class="token punctuation">:</span>
        <span class="token keyword">yield</span> idaapi<span class="token punctuation">.</span>object_t<span class="token punctuation">(</span>name<span class="token operator">=</span>mod<span class="token punctuation">.</span>name<span class="token punctuation">,</span> size<span class="token operator">=</span>mod<span class="token punctuation">.</span>size<span class="token punctuation">,</span> base<span class="token operator">=</span>mod<span class="token punctuation">.</span>base<span class="token punctuation">,</span> rebase_to<span class="token operator">=</span>mod<span class="token punctuation">.</span>rebase_to<span class="token punctuation">)</span>
        result <span class="token operator">=</span> idaapi<span class="token punctuation">.</span>get_next_module<span class="token punctuation">(</span>mod<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">MyDbgHook</span><span class="token punctuation">(</span>DBG_Hooks<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#GIF计数</span>
	count <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment">#保存目录</span>
	savepath <span class="token operator">=</span> <span class="token string">&quot;C:\\Users\\xxxxxx\\Desktop\\emotion&quot;</span>
	keyLocation <span class="token operator">=</span> <span class="token number">0</span>

	<span class="token keyword">def</span> <span class="token function">dbg_process_start</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pid<span class="token punctuation">,</span> tid<span class="token punctuation">,</span> ea<span class="token punctuation">,</span> name<span class="token punctuation">,</span> base<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#不要在这里插入断点</span>
		<span class="token comment">#for i in Modules():</span>
		<span class="token comment">#	if 'WeChatWin.dll' in i.name:</span>
		<span class="token comment">#		print &quot;module:[%s]\tsize:[%#x]\tbase:[%#x]\tend:[%#x]&quot; %(i.name, i.size, i.base, i.rebase_to)</span>
		<span class="token comment">#		self.keyLocation = i.base</span>
		<span class="token comment">#self.keyLocation += 0x247970</span>
		<span class="token comment">#AddBpt(self.keyLocation)</span>
		<span class="token comment">#print 'keybreakpoint:[%#x]' % self.keyLocation</span>
		<span class="token keyword">print</span> <span class="token string">&quot;MyDbgHook : Process started, pid=%d tid=%d name=%s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>pid<span class="token punctuation">,</span> tid<span class="token punctuation">,</span> name<span class="token punctuation">)</span>

	<span class="token keyword">def</span> <span class="token function">dbg_process_exit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pid<span class="token punctuation">,</span> tid<span class="token punctuation">,</span> ea<span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">:</span>  
	    <span class="token keyword">print</span> <span class="token string">&quot;MyDbgHook : Process exited pid=%d tid=%d ea=0x%x code=%d&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>pid<span class="token punctuation">,</span> tid<span class="token punctuation">,</span> ea<span class="token punctuation">,</span> code<span class="token punctuation">)</span>

	<span class="token keyword">def</span> <span class="token function">dbg_library_load</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pid<span class="token punctuation">,</span> tid<span class="token punctuation">,</span> ea<span class="token punctuation">,</span> name<span class="token punctuation">,</span> base<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">:</span>  
		<span class="token keyword">print</span> <span class="token string">&quot;MyDbgHook : Library loaded: pid=%d tid=%d name=%s base=%x&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>pid<span class="token punctuation">,</span> tid<span class="token punctuation">,</span> name<span class="token punctuation">,</span> base<span class="token punctuation">)</span>
        <span class="token comment"># 对WeChatWin.dll下断点</span>
        <span class="token keyword">if</span> <span class="token string">'WeChatWin.dll'</span> <span class="token keyword">in</span> name<span class="token punctuation">:</span>
			self<span class="token punctuation">.</span>keyLocation <span class="token operator">=</span> base
			self<span class="token punctuation">.</span>keyLocation <span class="token operator">=</span> self<span class="token punctuation">.</span>keyLocation <span class="token operator">+</span> <span class="token number">0x1000</span> <span class="token operator">+</span> <span class="token number">0x247970</span>
			AddBpt<span class="token punctuation">(</span>self<span class="token punctuation">.</span>keyLocation<span class="token punctuation">)</span>
			<span class="token keyword">print</span> <span class="token string">'keybreakpoint:[%#x]'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>keyLocation

	<span class="token keyword">def</span> <span class="token function">dbg_library_unload</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pid<span class="token punctuation">,</span> tid<span class="token punctuation">,</span> ea<span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">:</span>  
	    <span class="token keyword">print</span> <span class="token string">&quot;MyDbgHook : Library unloaded: pid=%d tid=%d ea=0x%x info=%s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>pid<span class="token punctuation">,</span> tid<span class="token punctuation">,</span> ea<span class="token punctuation">,</span> info<span class="token punctuation">)</span>
	    <span class="token keyword">return</span> <span class="token number">0</span>  

	<span class="token keyword">def</span> <span class="token function">dbg_bpt</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> tid<span class="token punctuation">,</span> ea<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span> <span class="token string">&quot;MyDbgHook : Break point at %s[0x%x] pid=%d&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>GetFunctionName<span class="token punctuation">(</span>ea<span class="token punctuation">)</span><span class="token punctuation">,</span> ea<span class="token punctuation">,</span> tid<span class="token punctuation">)</span>
        <span class="token comment">#是否到了关键的地址</span>
		<span class="token keyword">if</span> GetRegValue<span class="token punctuation">(</span><span class="token string">'eip'</span><span class="token punctuation">)</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>keyLocation <span class="token punctuation">:</span>
			location <span class="token operator">=</span> GetRegValue<span class="token punctuation">(</span><span class="token string">'edi'</span><span class="token punctuation">)</span>
			sizeptr <span class="token operator">=</span> GetRegValue<span class="token punctuation">(</span><span class="token string">'edi'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0x4</span>
			<span class="token keyword">print</span> <span class="token string">&quot;[*]\tGif location:[%08x],sizeptr:[%08x]&quot;</span><span class="token operator">%</span> <span class="token punctuation">(</span>location<span class="token punctuation">,</span> sizeptr<span class="token punctuation">)</span>
			start <span class="token operator">=</span> DbgDword<span class="token punctuation">(</span>location<span class="token punctuation">)</span>
			n <span class="token operator">=</span> DbgDword<span class="token punctuation">(</span>sizeptr<span class="token punctuation">)</span>
			<span class="token keyword">print</span> <span class="token string">&quot;[*]\tGif start:[%08x],n:[%08x]&quot;</span><span class="token operator">%</span> <span class="token punctuation">(</span>start<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
			dump <span class="token operator">=</span> DbgRead<span class="token punctuation">(</span>start<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
			f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>savepath<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'.gif'</span><span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span>
			f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>dump<span class="token punctuation">)</span>
			f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
			self<span class="token punctuation">.</span>count <span class="token operator">=</span> self<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>
		<span class="token keyword">else</span><span class="token punctuation">:</span>
			<span class="token keyword">print</span> <span class="token string">&quot;[%x] - [%x]&quot;</span> <span class="token operator">%</span><span class="token punctuation">(</span>GetRegValue<span class="token punctuation">(</span><span class="token string">'eip'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>keyLocation<span class="token punctuation">)</span>

		idaapi<span class="token punctuation">.</span>continue_process<span class="token punctuation">(</span><span class="token punctuation">)</span>  
		<span class="token keyword">return</span> <span class="token number">0</span>  

	<span class="token keyword">def</span> <span class="token function">dbg_suspend_process</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>  
	    <span class="token keyword">print</span> <span class="token string">&quot;MyDbgHook : Process suspended&quot;</span>

	<span class="token keyword">def</span> <span class="token function">dbg_step_into</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>  
	    <span class="token keyword">print</span> <span class="token string">&quot;MyDbgHook : Step into&quot;</span>
	    self<span class="token punctuation">.</span>dbg_step_over<span class="token punctuation">(</span><span class="token punctuation">)</span>

debughook <span class="token operator">=</span> MyDbgHook<span class="token punctuation">(</span><span class="token punctuation">)</span>  
debughook<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span> <span class="token string">&quot;ok&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br></div></div><h2 id="写在最后"><a href="#写在最后" class="header-anchor">#</a> 写在最后</h2> <p>通过ida python实现了获取微信GIF的功能，自动化脚本，加载模块自动下断，dump文件。只需要在手机上发送GIF，保存目录下就能得到对应的GIF。速度可以说是很快的。</p> <h2 id="战果"><a href="#战果" class="header-anchor">#</a> 战果</h2> <p><img src="/img/2018-08/Snipaste_2018-05-06_17-46-19.png" alt="wx22"></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">2020年5月22日 09:37</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/projects/" class="prev router-link-active">
        项目笔记
      </a></span> <span class="next"><a href="/projects/analysis-ms-17-010.html">
        MS17-010永恒之蓝分析
      </a>
      →
    </span></p></div>  <!----></main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.0d0fb6f2.js" defer></script><script src="/assets/js/10.82c11494.js" defer></script><script src="/assets/js/3.321f60fd.js" defer></script><script src="/assets/js/122.27124650.js" defer></script><script src="/assets/js/6.cf3d0550.js" defer></script>
  </body>
</html>
